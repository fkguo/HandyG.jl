#!/usr/bin/env bash
set -euo pipefail

TAG="${1:-M0-r1}"
NOTES="${2:-Draft_Derivation.md}"
OUT_DIR="${3:-team}"

MEMBER_A_SYSTEM="${MEMBER_A_SYSTEM:-prompts/_system_member_a.txt}"
MEMBER_B_SYSTEM="${MEMBER_B_SYSTEM:-prompts/_system_member_b.txt}"

LOCAL_RUNNER="${LOCAL_RUNNER:-}"

if [[ -n "${LOCAL_RUNNER}" ]]; then
  bash "${LOCAL_RUNNER}" "${TAG}"
elif [[ -x "scripts/run_local.sh" ]]; then
  bash "scripts/run_local.sh" "${TAG}"
fi

bash ~/.codex/skills/research-team/scripts/bin/run_team_cycle.sh \
  --tag "${TAG}" \
  --notes "${NOTES}" \
  --out-dir "${OUT_DIR}" \
  --member-a-system "${MEMBER_A_SYSTEM}" \
  --member-b-system "${MEMBER_B_SYSTEM}" \
  --auto-tag \
  --preflight-only

bash ~/.codex/skills/research-team/scripts/bin/run_team_cycle.sh \
  --tag "${TAG}" \
  --notes "${NOTES}" \
  --out-dir "${OUT_DIR}" \
  --member-a-system "${MEMBER_A_SYSTEM}" \
  --member-b-system "${MEMBER_B_SYSTEM}" \
  --auto-tag
